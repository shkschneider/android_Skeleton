// Android
apply plugin: 'com.android.library'
// Kotlin
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-android-extensions'
apply plugin: 'kotlin-kapt'
kapt.useBuildCache = true
// JitPack
apply plugin: 'com.github.dcendents.android-maven'
group='com.github.shkschneider'

android {
    defaultConfig {
        buildConfigField 'String', 'REVISION', "\"${gitRevision()}\""
    }
    externalNativeBuild {
        ndkBuild {
            path 'src/main/jni/Android.mk'
        }
    }
}

dependencies {
    version = '1.0.1'
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:${version}"
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:${version}"

    version = '1.0.0'
    implementation "androidx.core:core-ktx:${version}"
    implementation "androidx.appcompat:appcompat:${version}"
    implementation "androidx.recyclerview:recyclerview:${version}"
    implementation "androidx.palette:palette:${version}"

    version = '2.8.5'
    implementation "com.google.code.gson:gson:${version}"
}

task cleanCaches(type: Delete) {
    print '> Caches... '
    def caches = new File(getGradle().gradleUserHomeDir.path.toString(), 'caches')
    print "$caches\n"
    delete caches.listFiles()
}

task bump() {
    print '> Bump...'
    def versionCode = versionCode(true)
    print " v${versions.skeleton}r${versionCode}\n"
}
task ci() {
    print '> Travis...'
    travis(android)
    print " build-tools-${android.buildToolsVersion} android-${versions.android}\n"
}
tasks.whenTaskAdded { task ->
    if (task.name == 'preDebugBuild' || task.name == 'preReleaseBuild') {
        task.dependsOn bump
        task.dependsOn ci
    }
}
